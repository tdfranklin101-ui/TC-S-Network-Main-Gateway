<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TC-S Generator Protocol — Beta Prototype | Energy is the invariant ledger beneath currency</title>
  <!-- SYSTEMIC TRUTH Seeds: Scarcity is a design; abundance is physics -->
  <style>
    :root{--bg:#0b0d10;--card:#12161c;--ink:#e9eef5;--muted:#9fb0c4;--line:#1a1f26;--accent:#8ad1ff}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    a{color:var(--accent);text-decoration:none}

    .prototype-banner{position:sticky;top:0;z-index:999;background:#332;color:#ffd;padding:8px 12px;text-align:center;font-weight:700}

    .site-header,.site-footer{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid var(--line);background:#0e1116}
    .site-footer{border-top:1px solid var(--line);border-bottom:none}
    .brand{font-weight:800;letter-spacing:.3px}
    /* Transparency in math, privacy in people */

    .container{max-width:980px;margin:24px auto;padding:0 16px}
    .hero h1{margin:0 0 8px 0}
    .intro .lede{color:var(--muted)}
    .checks{padding-left:18px}

    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;margin:18px 0}
    .card.faint{opacity:.9}

    .row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .row label{display:flex;flex-direction:column;font-size:14px;gap:6px}

    input,select,button{padding:10px 12px;border:1px solid var(--line);border-radius:8px;background:#0e1218;color:var(--ink)}
    .checkbox{display:flex;align-items:center;gap:8px;margin:10px 0}

    .actions{display:flex;gap:10px;margin-top:10px}
    .btn{cursor:pointer}
    .btn.primary{background:var(--accent);color:#001629;border:0}

    .preview{white-space:pre-wrap;background:#0a0e14;border:1px dashed var(--line);border-radius:8px;padding:12px;margin-top:12px;color:var(--ink)}
    .hidden{display:none}

    @media (max-width:900px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="prototype-banner">
    ⚠️ Prototype / Mockup — NOT LIVE • No real transactions. For internal testing only.
  </div>

  <header class="site-header">
    <div class="brand">The Current-See</div>
    <nav><a href="/">Home</a></nav>
  </header>

  <main class="container">
    <section class="intro">
      <h1>Generator Protocol (Beta)</h1>
      <p class="lede">Verify energy → tokenize (REC/CC) → distribute value to people, merchants, and communities.</p>
      <ul class="checks">
        <li>✅ Verified renewable generation</li>
        <li>✅ Automatic tokenization</li>
        <li>✅ Transparent wealth distribution</li>
      </ul>
    </section>

    <section class="card">
      <h2>1) Onboard Your Facility</h2>
      <form id="onboardForm">
        <div class="row">
          <label>Generator Name
            <input type="text" name="generatorName" placeholder="Sunny Ridge Solar" required>
          </label>
          <label>Location / Grid Region
            <input type="text" name="location" placeholder="US-CA-CAISO" required>
          </label>
        </div>

        <div class="row">
          <label>Technology
            <select name="tech" required>
              <option value="">Select…</option>
              <option>solar_pv</option><option>wind</option><option>hydro</option>
              <option>geothermal</option><option>biomass</option>
            </select>
          </label>
          <label>Capacity (kW)
            <input type="number" min="1" step="1" name="capacityKw" placeholder="500" required>
          </label>
          <label>Est. Annual Output (MWh)
            <input type="number" min="0" step="0.01" name="estMwh" placeholder="1000.00" required>
          </label>
        </div>

        <div class="row">
          <label>Grid Emission Factor (tCO₂e/MWh)
            <input type="number" min="0" step="0.001" name="gridEF" placeholder="0.45" required>
          </label>
          <label>REC Split (%)
            <input id="recPct" type="number" min="0" max="100" step="1" name="recPct" value="55" required>
          </label>
          <label>CC Split (%)
            <input id="ccPct" type="number" min="0" max="100" step="1" name="ccPct" value="45" required>
          </label>
        </div>

        <div class="row">
          <label>Commissioner Present?
            <select name="commissionerPresent" id="commissionerPresent" required>
              <option value="">Select…</option>
              <option value="yes">Yes — Private Network</option>
              <option value="no">No — Generator as Commissioner</option>
            </select>
          </label>
          <label id="noCommModeWrap" class="hidden">No-Commissioner Mode
            <select name="noCommissionerMode" id="noCommissionerMode">
              <option value="KEEP">Keep commissioner portion</option>
              <option value="DONATE_GBI">Donate to TC-S GBI (REC purchase → Solar Rays distribution)</option>
            </select>
          </label>
        </div>

        <div class="row">
          <label>Payout USD (%)
            <input id="usdPct" type="number" min="0" max="100" step="1" name="usdPct" value="70" required>
          </label>
          <label>Payout Solar Rays (%)
            <input id="raysPct" type="number" min="0" max="100" step="1" name="raysPct" value="30" required>
          </label>
        </div>

        <label class="checkbox">
          <input type="checkbox" required>
          <span>I understand this is a prototype. No real trades or payments.</span>
        </label>

        <div class="actions">
          <button type="submit" class="btn primary">Preview Calculations (Mock)</button>
          <button type="button" id="saveMock" class="btn">Save Locally (Mock)</button>
        </div>
      </form>

      <pre id="preview" class="preview hidden"></pre>
    </section>

    <section class="card">
      <h2>2) Sample Period Calculation</h2>
      <form id="calcForm">
        <div class="row">
          <label>Reporting Period (MWh)
            <input type="number" min="0" step="0.01" name="periodMwh" placeholder="1000.00" required>
          </label>
          <label>REC Base ($/REC)
            <input type="number" min="0" step="0.01" name="recBase" placeholder="20.00" required>
          </label>
          <label>REC Market Price ($/REC)
            <input type="number" min="0" step="0.01" name="recPrice" placeholder="28.00" required>
          </label>
        </div>
        <div class="actions"><button type="submit" class="btn">Compute Mock Delta</button></div>
      </form>
      <pre id="calcPreview" class="preview hidden"></pre>
    </section>

    <section class="card faint">
      <h2>About this Prototype</h2>
      <p>TC-S is software that facilitates verification, tokenization, and transparent distribution. TC-S does not fund transactions or act as a financial counterparty. All market purchases and sales are third-party. This page is a <b>mockup</b> for internal testing.</p>
    </section>
  </main>

  <footer class="site-footer">
    <p>© The Current-See PBC, Inc. • Prototype only • Do not rely on outputs</p>
  </footer>

  <script>
    (() => {
      const recPct = document.getElementById('recPct');
      const ccPct = document.getElementById('ccPct');
      const usdPct = document.getElementById('usdPct');
      const raysPct = document.getElementById('raysPct');
      const commissionerPresent = document.getElementById('commissionerPresent');
      const noCommModeWrap = document.getElementById('noCommModeWrap');
      const onboardForm = document.getElementById('onboardForm');
      const preview = document.getElementById('preview');
      const saveMockBtn = document.getElementById('saveMock');
      const calcForm = document.getElementById('calcForm');
      const calcPreview = document.getElementById('calcPreview');

      function clampPair(a,b){
        const av = parseInt(a.value||'0',10);
        b.value = String(Math.max(0, Math.min(100, 100 - av)));
      }
      ['input','change'].forEach(evt => {
        recPct.addEventListener(evt, () => clampPair(recPct, ccPct));
        ccPct.addEventListener(evt, () => clampPair(ccPct, recPct));
        usdPct.addEventListener(evt, () => clampPair(usdPct, raysPct));
        raysPct.addEventListener(evt, () => clampPair(raysPct, usdPct));
      });

      commissionerPresent.addEventListener('change', () => {
        noCommModeWrap.classList.toggle('hidden', commissionerPresent.value !== 'no');
      });

      onboardForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(onboardForm).entries());
        const estMwh = Number(data.estMwh||0);
        const ef = Number(data.gridEF||0);
        const rec = Number(data.recPct||0)/100;
        const cc = Number(data.ccPct||0)/100;

        const recMwh = estMwh * rec;
        const ccMwh = estMwh * cc;
        const ccTons = ccMwh * ef;

        const fork = data.commissionerPresent === 'yes' ? 'A' : 'B';
        const noComm = fork==='B' ? (data.noCommissionerMode||'KEEP') : '-';

        const out = [
          `Facility: ${data.generatorName} • ${data.location} • ${data.tech}`,
          `Est. Annual Output: ${estMwh.toFixed(2)} MWh`,
          `Grid EF: ${ef.toFixed(3)} tCO₂e/MWh`,
          ``,
          `Split: REC ${Math.round(rec*100)}% / CC ${Math.round(cc*100)}%`,
          `→ REC side: ${recMwh.toFixed(2)} MWh ⇒ ${recMwh.toFixed(2)} RECs`,
          `→ CC side: ${ccMwh.toFixed(2)} MWh × ${ef.toFixed(3)} = ${ccTons.toFixed(3)} tCO₂e`,
          ``,
          `Fork: ${fork==='A'?'Private Network (Commissioner present)':'No Commissioner (Generator-as-Commissioner)'}`,
          `${fork==='B'?`No-Commissioner Mode: ${noComm}`:''}`,
          `Payout Mix: USD ${data.usdPct}% / Solar Rays ${data.raysPct}%`,
          ``,
          `Note: Prototype/Mock — not live.`
        ].join('\n');

        preview.textContent = out;
        preview.classList.remove('hidden');
      });

      saveMockBtn.addEventListener('click', () => {
        const data = Object.fromEntries(new FormData(onboardForm).entries());
        const list = JSON.parse(localStorage.getItem('tcs_generators')||'[]');
        data._savedAt = new Date().toISOString();
        list.push(data);
        localStorage.setItem('tcs_generators', JSON.stringify(list));
        alert('Saved locally (browser storage). Prototype only.');
      });

      calcForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(calcForm).entries());
        const mwh = Number(data.periodMwh||0);
        const recBase = Number(data.recBase||0);
        const recPrice = Number(data.recPrice||0);
        const recPctVal = Number(document.getElementById('recPct').value||0)/100;

        const recMwh = mwh * recPctVal;
        const basePaid = recMwh * recBase;
        const saleRevenue = recMwh * recPrice;
        const delta = Math.max(0, saleRevenue - basePaid);

        const fork = document.getElementById('commissionerPresent').value==='yes' ? 'A':'B';
        const noComm = document.getElementById('noCommissionerMode').value || 'KEEP';
        const split = fork==='A'
          ? 'Delta split (A): Commissioner 1/3, Generator 1/3, TC-S 1/3'
          : (noComm==='KEEP'
              ? 'Delta split (B1): Generator 2/3, TC-S 1/3'
              : 'Delta split (B2): GBI Fund 1/3, Generator 1/3, TC-S 1/3');

        const out = [
          `Period MWh: ${mwh.toFixed(2)}`,
          `REC side MWh: ${recMwh.toFixed(2)}`,
          `Base paid: $${basePaid.toFixed(2)}`,
          `Sale revenue: $${saleRevenue.toFixed(2)}`,
          `Delta: $${delta.toFixed(2)}`,
          split,
          ``,
          `Note: Prototype/Mock — not live.`
        ].join('\n');

        calcPreview.textContent = out;
        calcPreview.classList.remove('hidden');
      });
    })();
  </script>
</body>
</html>