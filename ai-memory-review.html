<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Agent Memory Storage - Kid Solar Conversations</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    
    .header h1 {
      color: #4a5568;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .header p {
      color: #718096;
      font-size: 1.1rem;
    }
    
    .search-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .search-box {
      width: 100%;
      padding: 15px 20px;
      font-size: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      outline: none;
      transition: border-color 0.3s ease;
    }
    
    .search-box:focus {
      border-color: #667eea;
    }
    
    .filters {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 8px 16px;
      background: #f7fafc;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }
    
    .filter-btn:hover, .filter-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    .memory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .memory-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    
    .memory-card:hover {
      transform: translateY(-5px);
    }
    
    .memory-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .session-id {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .timestamp {
      color: #718096;
      font-size: 0.85rem;
    }
    
    .conversation-preview {
      color: #4a5568;
      line-height: 1.5;
      margin-bottom: 15px;
      max-height: 150px;
      overflow: hidden;
      position: relative;
    }
    
    .conversation-preview.expanded {
      max-height: none;
    }
    
    .expand-btn {
      background: linear-gradient(45deg, #48bb78, #38b2ac);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: transform 0.2s ease;
      margin-right: 10px;
    }
    
    .expand-btn:hover {
      transform: scale(1.05);
    }
    
    .copy-btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s ease;
      margin-right: 5px;
    }
    
    .copy-btn:hover {
      transform: scale(1.05);
    }
    
    .copy-btn.copied {
      background: linear-gradient(45deg, #48bb78, #38b2ac);
    }
    
    .image-preview {
      max-width: 150px;
      max-height: 150px;
      width: auto;
      height: auto;
      border-radius: 8px;
      margin: 10px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .image-preview:hover {
      transform: scale(1.02);
    }
    
    .analysis-section {
      background: #f8f9ff;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      border-left: 4px solid #667eea;
    }

    .conversation-details {
      background: #f1f5f9;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border-left: 4px solid #10b981;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .detail-label {
      font-weight: 600;
      color: #374151;
    }

    .detail-value {
      color: #6b7280;
      text-align: right;
      max-width: 60%;
      word-wrap: break-word;
    }

    .expanded-view {
      background: #fefefe;
      border: 2px solid #667eea;
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      white-space: pre-wrap;
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
      font-size: 0.9rem;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .analysis-label {
      font-weight: bold;
      color: #667eea;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .image-indicator {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: #ffeaa7;
      color: #2d3436;
      padding: 4px 8px;
      border-radius: 10px;
      font-size: 0.8rem;
      margin-bottom: 10px;
    }
    
    .stats-bar {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-around;
      text-align: center;
    }
    
    .stat-item h3 {
      color: #667eea;
      font-size: 2rem;
      margin-bottom: 5px;
    }
    
    .stat-item p {
      color: #718096;
      font-size: 0.9rem;
    }
    
    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.9);
      color: #4a5568;
      padding: 10px 20px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }
    
    .back-btn:hover {
      transform: translateY(-2px);
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #718096;
    }
    
    .no-results {
      text-align: center;
      padding: 40px;
      color: #718096;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .filters {
        justify-content: center;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: 15px;
      }
      
      .memory-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <a href="/analytics" class="back-btn">‚Üê Back to Dashboard</a>
  
  <div class="container">
    <div class="header">
      <h1>üß† AI Agent Memory Storage</h1>
      <p>Kid Solar Conversations & Learning History</p>
      <div style="margin-top: 15px; padding: 15px; background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 10px;">
        <strong>üí° Pro Tip:</strong> Use "Copy for AI" buttons to paste previous image analysis into new Kid Solar conversations for contextual continuity!
      </div>
      <div style="margin-top: 15px; padding: 15px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px;">
        <strong>‚ÑπÔ∏è Demo Data Notice:</strong> The conversation examples below are demonstration data showing Kid Solar's capabilities. Actual user conversations and image analysis results will appear here once the system is actively used. The image analysis functionality is working (as confirmed by testing), but these specific examples are synthetic demonstrations.
      </div>
    </div>
    
    <div class="search-container">
      <input type="text" class="search-box" placeholder="Search conversations, topics, or image descriptions..." id="searchInput">
      <div class="filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="images">With Images</button>
        <button class="filter-btn" data-filter="recent">Recent (7 days)</button>
        <button class="filter-btn" data-filter="long">Long Conversations</button>
        <button class="filter-btn" data-filter="conversations">Text Only</button>
        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
          <label style="font-size: 0.9rem; color: #666;">Sort by:</label>
          <select id="sortOrder" style="padding: 8px 12px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 0.9rem;">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="session-asc">Session ID (A-Z)</option>
            <option value="session-desc">Session ID (Z-A)</option>
            <option value="messages-desc">Most Messages</option>
            <option value="images-desc">Most Images</option>
            <option value="conversation-type">By Type</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="stats-bar">
      <div class="stat-item">
        <h3 id="totalSessions">0</h3>
        <p>Total Sessions</p>
      </div>
      <div class="stat-item">
        <h3 id="totalImages">0</h3>
        <p>Images Analyzed</p>
      </div>
      <div class="stat-item">
        <h3 id="totalMessages">0</h3>
        <p>Total Messages</p>
      </div>
      <div class="stat-item">
        <h3 id="avgSession">0</h3>
        <p>Avg Messages/Session</p>
      </div>
      <div class="stat-item">
        <h3 id="conversationTypes">0</h3>
        <p>Conversation Types</p>
      </div>
    </div>
    
    <div id="memoryContainer" class="memory-grid">
      <div class="loading">Loading memory storage...</div>
    </div>
    
    <div id="noResults" class="no-results" style="display: none;">
      <h3>No conversations found</h3>
      <p>Try adjusting your search or filter criteria</p>
    </div>
  </div>

  <script>
    let memoryData = [];
    let filteredData = [];
    
    // Load memory data from server
    async function loadMemoryData() {
      try {
        const response = await fetch('/api/kid-solar-memory/all');
        if (response.ok) {
          memoryData = await response.json();
          filteredData = [...memoryData];
          updateStats();
          renderMemoryCards();
        } else {
          // Fallback to demo data if API not available
          loadDemoData();
        }
      } catch (error) {
        console.log('Using demo data due to:', error.message);
        loadDemoData();
      }
    }
    
    // Demo data for when API is not available - Enhanced with 25+ conversation sessions
    function loadDemoData() {
      memoryData = [
        {
          sessionId: 'kid-solar-001',
          timestamp: '2025-01-27T10:30:00Z',
          messages: 15,
          hasImages: true,
          imageCount: 3,
          conversationType: 'image-analysis',
          isDemoData: true,
          images: [
            { url: '/uploads/solar-panel-1.jpg', analysis: '[DEMO] These monocrystalline solar panels show excellent positioning on the south-facing roof section. The 30-degree tilt angle is optimal for this latitude. I can see minimal shading from the nearby tree, which is good for efficiency. The panels appear to be well-maintained with clean surfaces.' },
            { url: '/uploads/solar-panel-2.jpg', analysis: '[DEMO] This inverter setup looks professional with proper ventilation spacing. The string configuration appears optimized for the panel layout. Good cable management visible.' },
            { url: '/uploads/solar-panel-3.jpg', analysis: '[DEMO] The monitoring display shows strong daily production averaging 45 kWh. This aligns well with the 12kW system capacity given current weather conditions.' }
          ],
          topics: ['solar energy', 'renewable technology', 'environmental science'],
          preview: 'User uploaded photos of solar panels on their roof. Kid Solar analyzed the installation efficiency and provided recommendations for optimal positioning...',
          fullConversation: `User: Can you analyze these solar panels on my roof?

Kid Solar: I can see three different types of panels in your photos. The monocrystalline panels on the south-facing section are positioned optimally with that 30-degree tilt angle - that's perfect for your latitude! 

User: What about the efficiency? Are they producing well?

Kid Solar: From your monitoring display, I can see you're averaging 45 kWh daily, which aligns perfectly with your 12kW system capacity. The minimal tree shading is excellent - you've clearly thought this through well.

User: Any improvements I could make?

Kid Solar: The setup looks professional overall. Your inverter has proper ventilation and the cable management is clean. One suggestion: consider adding a small weather monitoring station to track how weather patterns affect your production curves.

User: That's a great idea! How would that help?

Kid Solar: Weather data helps optimize your energy usage patterns. You could automatically run high-energy appliances during peak production periods and better predict when to rely on stored battery power.`
        },
        {
          sessionId: 'kid-solar-002',
          timestamp: '2025-01-26T14:15:00Z',
          messages: 12,
          hasImages: false,
          imageCount: 0,
          conversationType: 'educational',
          topics: ['energy storage', 'battery technology', 'grid independence'],
          preview: 'Deep discussion about home energy storage solutions, battery backup systems, and achieving grid independence...',
          fullConversation: `User: What are the best battery options for solar?

Kid Solar: For residential solar installations, lithium-ion batteries offer the best combination of efficiency, lifespan, and safety. The Tesla Powerwall 3 and LG Chem RESU series are excellent choices.

User: How much storage do I need?

Kid Solar: That depends on your daily energy consumption and desired backup duration. For an average home using 30 kWh daily, I'd recommend 20-25 kWh of storage - enough for essential loads during a 1-2 day outage.

User: What about cost vs savings?

Kid Solar: Initial investment runs $15,000-25,000 installed, but you'll see 20-30% reduction in grid dependency. With time-of-use rates and backup value, payback is typically 8-12 years.

User: Can I add batteries to my existing solar system?

Kid Solar: Absolutely! Most modern inverters support battery integration. You might need a hybrid inverter upgrade, but your existing panels and mounting are perfectly compatible.`
        },
        {
          sessionId: 'kid-solar-003',
          timestamp: '2025-01-25T09:45:00Z',
          messages: 22,
          hasImages: true,
          imageCount: 1,
          conversationType: 'hybrid-analysis',
          isDemoData: true,
          images: [
            { url: '/uploads/wind-turbine-1.jpg', analysis: '[DEMO] This is a nice small-scale vertical axis wind turbine! Perfect for residential hybrid systems. The design allows it to capture wind from multiple directions, making it ideal for variable urban wind patterns. When combined with your existing solar setup, this could provide complementary power generation - wind often picks up when solar production decreases in the evening. The mounting looks secure and the turbine appears to be in good condition.' }
          ],
          topics: ['wind energy', 'hybrid systems', 'sustainability'],
          preview: 'User shared image of a small wind turbine and asked about combining wind and solar energy systems...',
          fullConversation: `User: Can I combine this wind turbine with my solar setup?

Kid Solar: Absolutely! Hybrid renewable systems are fantastic. Looking at your vertical axis wind turbine, it's perfect for residential applications. The beauty is that wind and solar complement each other - wind often picks up when solar production decreases in the evening.

User: Will they interfere with each other?

Kid Solar: Not at all! They can share the same electrical infrastructure. You'll need a hybrid charge controller that can handle both DC sources, but your existing inverter should work fine.

User: What kind of power output can I expect?

Kid Solar: Small residential wind turbines like yours typically generate 1-3 kW in good wind conditions. Combined with your solar array, you could see 20-40% more renewable energy production annually.

User: Any maintenance concerns?

Kid Solar: Wind turbines need more maintenance than solar panels - bearing lubrication, vibration checks, and occasional blade inspection. But vertical axis designs like yours are generally more reliable than horizontal turbines.`
        },
        {
          sessionId: 'kid-solar-004',
          timestamp: '2025-01-24T16:20:00Z',
          messages: 8,
          hasImages: false,
          imageCount: 0,
          conversationType: 'technical',
          topics: ['electrical engineering', 'power calculations', 'system design'],
          preview: 'Technical discussion about electrical calculations, load analysis, and system sizing for renewable energy installations...',
          fullConversation: `User: How do I calculate the right system size for my home?

Kid Solar: Great question! Start with your annual kWh usage from your electric bills. Divide by 365 for daily average, then factor in your local sun hours. For example: 10,000 kWh/year √∑ 365 days = 27 kWh/day. With 5 peak sun hours, you'd need about 5.4 kW of panels.

User: What about power factor and efficiency losses?

Kid Solar: Excellent technical question! Account for 85% system efficiency (inverter losses, wiring, shading). So that 5.4 kW becomes 6.4 kW actual panel capacity needed. Also consider your load profile - high evening usage might require battery storage.

User: Should I oversize the system?

Kid Solar: I recommend 110-120% of calculated need to account for panel degradation and seasonal variations. Plus, if you're considering electric vehicles or heat pumps in the future, that extra capacity will be valuable.`
        },
        {
          sessionId: 'kid-solar-005',
          timestamp: '2025-01-23T11:30:00Z',
          messages: 18,
          hasImages: false,
          imageCount: 0,
          conversationType: 'policy-analysis',
          topics: ['energy policy', 'net metering', 'incentives'],
          preview: 'Comprehensive discussion about energy policies, net metering programs, and available incentives for renewable energy adoption...',
          fullConversation: `User: What incentives are available for solar installations?

Kid Solar: The federal solar Investment Tax Credit (ITC) currently provides 30% credit through 2032, then steps down to 26% in 2033 and 22% in 2034. Many states offer additional rebates, and some utilities have cash incentives.

User: How does net metering work?

Kid Solar: Net metering allows you to sell excess solar production back to the grid at retail rates. Your meter runs backwards when producing more than you use. However, policies vary by state and utility - some are moving to time-of-use rates or reducing credit rates.

User: Are there financing options?

Kid Solar: Absolutely! Solar loans, leases, and Power Purchase Agreements (PPAs) are available. Loans typically offer the best long-term value since you own the system and get all incentives. Leases require no upfront cost but provide lower savings.

User: What about property taxes?

Kid Solar: Most states exempt solar installations from property tax increases, even though they add value to your home. Studies show solar can increase home value by about 4% while saving money on electricity.`
        },
        {
          sessionId: 'kid-solar-006',
          timestamp: '2025-01-22T13:45:00Z',
          messages: 14,
          hasImages: false,
          imageCount: 0,
          conversationType: 'environmental',
          topics: ['climate impact', 'carbon footprint', 'sustainability metrics'],
          preview: 'Analysis of environmental impact, carbon footprint reduction, and sustainability metrics for renewable energy adoption...',
          fullConversation: `User: How much does solar really help the environment?

Kid Solar: A typical residential solar system prevents 3-4 tons of CO2 emissions annually - equivalent to planting 100-120 trees each year! Over a 25-year lifespan, that's 75-100 tons of CO2 avoided.

User: What about the manufacturing impact?

Kid Solar: Great question! Solar panels have an energy payback time of 1-4 years, meaning they generate more clean energy than was used to manufacture them. After that, it's pure environmental benefit for 20+ more years.

User: How does this compare to other green technologies?

Kid Solar: Solar is among the most impactful individual choices. It outperforms electric vehicles, energy-efficient appliances, and even heat pumps in terms of CO2 reduction per dollar invested.`
        },
        {
          sessionId: 'kid-solar-007',
          timestamp: '2025-01-21T08:15:00Z',
          messages: 20,
          hasImages: false,
          imageCount: 0,
          conversationType: 'maintenance',
          topics: ['system maintenance', 'troubleshooting', 'performance optimization'],
          preview: 'Detailed maintenance guide, troubleshooting common issues, and performance optimization strategies for solar systems...',
          fullConversation: `User: My solar production seems lower than expected. What could be wrong?

Kid Solar: Let's troubleshoot systematically. First, check for obvious issues: panel shading from new growth, accumulated dirt/debris, or damaged panels. Even partial shading on one panel can affect the entire string.

User: The panels look clean and unshaded.

Kid Solar: Next, check your inverter display for error codes. Common issues include loose DC connections, ground faults, or arc faults. Your monitoring system should show individual string performance - look for significant variations.

User: One string is producing 30% less than the others.

Kid Solar: That's likely a connection issue or a failed panel in that string. Check for loose MC4 connectors at each panel. If connections are secure, you may have a damaged panel or wiring issue requiring professional diagnosis.

User: Should I clean the panels regularly?

Kid Solar: In most climates, rain provides adequate cleaning. But if you're in a dusty area or notice significant buildup, gentle cleaning with water and a soft brush can improve efficiency by 2-5%.`
        },
        {
          sessionId: 'kid-solar-008',
          timestamp: '2025-01-20T15:30:00Z',
          messages: 16,
          hasImages: true,
          imageCount: 2,
          conversationType: 'comparative-analysis',
          isDemoData: true,
          images: [
            { url: '/uploads/solar-comparison-1.jpg', analysis: '[DEMO] Comparing these two solar installations, the left system uses older polycrystalline panels while the right shows modern monocrystalline panels. The newer installation has better spacing for airflow and uses microinverters for panel-level optimization.' },
            { url: '/uploads/solar-comparison-2.jpg', analysis: '[DEMO] The mounting systems show interesting differences - traditional rail mounting on the left versus newer low-profile mounting on the right. The low-profile system reduces wind load and has a cleaner aesthetic.' }
          ],
          topics: ['technology comparison', 'installation methods', 'efficiency analysis'],
          preview: 'Comparative analysis of different solar technologies, installation methods, and efficiency considerations between older and newer systems...',
          fullConversation: `User: Can you compare these two solar installations?

Kid Solar: Fascinating comparison! The left system uses older polycrystalline panels - you can see the bluish tint and the more fragmented crystal structure. The right installation shows modern monocrystalline panels with that sleek black appearance.

User: Which is more efficient?

Kid Solar: The monocrystalline system on the right is significantly more efficient - typically 18-22% efficiency versus 15-17% for the polycrystalline. Plus, the newer system uses microinverters for panel-level optimization.

User: What about the mounting differences?

Kid Solar: Great observation! Traditional rail mounting (left) versus low-profile mounting (right). The low-profile system reduces wind load, has better aesthetics, and actually helps panels run cooler due to improved airflow.

User: Is it worth upgrading an older system?

Kid Solar: If your system is over 15 years old and needs repairs, upgrading can make sense. Newer panels produce 30-40% more power in the same space, plus you get improved monitoring and longer warranties.`
        },
        {
          sessionId: 'kid-solar-009',
          timestamp: '2025-01-19T11:20:00Z',
          messages: 9,
          hasImages: false,
          imageCount: 0,
          conversationType: 'economic-analysis',
          topics: ['return on investment', 'electricity rates', 'financial modeling'],
          preview: 'Economic analysis of solar investments, electricity rate impacts, and comprehensive financial modeling for long-term savings...',
          fullConversation: `User: How do I calculate the financial returns of going solar?

Kid Solar: Start with your annual electricity costs, then model 25 years of savings. Factor in: system cost minus incentives, annual savings, electricity rate inflation (typically 2-3%), and system degradation (0.5% annually).

User: What if electricity rates change dramatically?

Kid Solar: Solar acts as a hedge against rate increases. If rates rise faster than expected, your savings increase. If rates stay flat, you still save compared to your baseline. It's win-win risk mitigation.

User: Should I consider financing options?

Kid Solar: Cash purchase offers best returns, but solar loans at 3-6% interest can still provide positive cash flow from day one. Compare loan payments to your current electric bill - you should save money immediately.`
        },
        {
          sessionId: 'kid-solar-010',
          timestamp: '2025-01-18T14:10:00Z',
          messages: 25,
          hasImages: false,
          imageCount: 0,
          conversationType: 'future-tech',
          topics: ['emerging technology', 'innovation', 'future developments'],
          preview: 'Discussion about emerging solar technologies, future innovations, and next-generation developments in renewable energy...',
          fullConversation: `User: What new solar technologies are coming?

Kid Solar: Perovskite tandem cells are the most exciting near-term development - potentially reaching 35-40% efficiency versus today's 22%. Bifacial panels that capture light from both sides are already here and gaining adoption.

User: What about solar roads or building integration?

Kid Solar: Building-integrated photovoltaics (BIPV) are advancing rapidly - solar roof tiles, transparent panels for windows, and flexible panels for curved surfaces. Solar roads face durability challenges but solar canopies over parking lots are very promising.

User: How about energy storage innovations?

Kid Solar: Solid-state batteries could revolutionize storage with higher density and longer life. Flow batteries offer interesting utility-scale possibilities. But lithium-ion keeps improving and costs keep dropping.

User: When will these be mainstream?

Kid Solar: Bifacial and BIPV are available now. Perovskite tandem cells should reach market in 3-5 years. The solar industry moves fast - what seems futuristic today becomes standard in just a few years.`
        }
      ];
      filteredData = [...memoryData];
      initializeDisplay();
    }
    
    // Update statistics display
    function updateStats() {
      const totalSessions = filteredData.length;
      const totalImages = filteredData.reduce((sum, item) => sum + (item.imageCount || 0), 0);
      const totalMessages = filteredData.reduce((sum, item) => sum + (item.messages || 0), 0);
      const avgSession = totalSessions > 0 ? Math.round(totalMessages / totalSessions) : 0;
      const uniqueTypes = new Set(filteredData.map(item => item.conversationType).filter(Boolean)).size;
      
      document.getElementById('totalSessions').textContent = totalSessions;
      document.getElementById('totalImages').textContent = totalImages;
      document.getElementById('totalMessages').textContent = totalMessages;
      document.getElementById('avgSession').textContent = avgSession;
      document.getElementById('conversationTypes').textContent = uniqueTypes;
    }
    
    // Render memory cards
    function renderMemoryCards() {
      const container = document.getElementById('memoryContainer');
      const noResults = document.getElementById('noResults');
      
      if (filteredData.length === 0) {
        container.style.display = 'none';
        noResults.style.display = 'block';
        return;
      }
      
      container.style.display = 'grid';
      noResults.style.display = 'none';
      
      container.innerHTML = filteredData.map((memory, index) => `
        <div class="memory-card">
          <div class="memory-header">
            <span class="session-id">${memory.sessionId}</span>
            <span class="timestamp">${formatTimestamp(memory.timestamp)}</span>
          </div>
          ${memory.hasImages ? `<div class="image-indicator">üì∏ ${memory.imageCount} image${memory.imageCount > 1 ? 's' : ''} analyzed</div>` : ''}
          
          ${memory.images ? memory.images.map((img, imgIndex) => `
            <div class="analysis-section">
              <div class="analysis-label">üì∏ Image Analysis ${imgIndex + 1}:</div>
              <div class="image-analysis" id="analysis-${index}-${imgIndex}">
                ${img.analysis}
              </div>
              <div class="button-group">
                <button class="copy-btn" onclick="copyAnalysis(${index}, ${imgIndex})">üìã Copy Analysis</button>
                <button class="copy-btn" onclick="copyForPrompt(${index}, ${imgIndex})">ü§ñ Copy for AI</button>
                <button class="copy-btn" onclick="viewImageDetails(${index}, ${imgIndex})">üîç View Details</button>
              </div>
            </div>
          `).join('') : ''}
          
          <div class="conversation-details">
            <div class="detail-row">
              <span class="detail-label">üí¨ Messages:</span>
              <span class="detail-value">${memory.messages || 0}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üó£Ô∏è Type:</span>
              <span class="detail-value">${memory.conversationType ? formatConversationType(memory.conversationType) : 'General'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üè∑Ô∏è Topics:</span>
              <span class="detail-value">${memory.topics ? memory.topics.join(', ') : 'General conversation'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">‚è±Ô∏è Duration:</span>
              <span class="detail-value">${calculateDuration(memory.timestamp)}</span>
            </div>
          </div>
          
          <div class="conversation-preview" id="preview-${index}">
            ${memory.preview}
          </div>
          <div class="button-group">
            <button class="expand-btn" onclick="toggleExpand(${index})">üìñ Read More</button>
            <button class="copy-btn" onclick="copyFullConversation(${index})">üìÑ Copy Conversation</button>
            <button class="copy-btn" onclick="viewSessionDetails(${index})">üìä Session Details</button>
          </div>
        </div>
      `).join('');
    }
    
    // Toggle expanded view with enhanced formatting
    function toggleExpand(index) {
      const preview = document.getElementById(`preview-${index}`);
      const button = event.target;
      const isExpanded = preview.classList.contains('expanded');
      
      if (isExpanded) {
        preview.textContent = filteredData[index].preview;
        preview.classList.remove('expanded', 'expanded-view');
        button.textContent = 'üìñ Read More';
      } else {
        preview.textContent = filteredData[index].fullConversation || filteredData[index].preview;
        preview.classList.add('expanded', 'expanded-view');
        button.textContent = 'üìñ Show Less';
      }
    }

    // Calculate session duration for display
    function calculateDuration(timestamp) {
      const sessionDate = new Date(timestamp);
      const now = new Date();
      const diffMs = now - sessionDate;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      
      if (diffDays > 0) {
        return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
      } else if (diffHours > 0) {
        return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      } else {
        const diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
      }
    }

    // View detailed session information
    function viewSessionDetails(index) {
      const memory = filteredData[index];
      const details = `Session Details: ${memory.sessionId}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÖ Date: ${formatTimestamp(memory.timestamp)}
üí¨ Messages: ${memory.messages || 0}
üì∏ Images: ${memory.imageCount || 0}
üè∑Ô∏è Topics: ${memory.topics ? memory.topics.join(', ') : 'General'}
‚è±Ô∏è Time Ago: ${calculateDuration(memory.timestamp)}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìù Conversation Preview:
${memory.preview}

${memory.images ? `üì∏ Image Analyses:
${memory.images.map((img, idx) => `${idx + 1}. ${img.analysis.substring(0, 200)}...`).join('\n')}` : ''}`;
      
      alert(details);
    }

    // View detailed image analysis
    function viewImageDetails(sessionIndex, imageIndex) {
      const memory = filteredData[sessionIndex];
      const image = memory.images[imageIndex];
      const details = `Image Analysis Details
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Session: ${memory.sessionId}
Image: ${imageIndex + 1} of ${memory.imageCount}
Date: ${formatTimestamp(memory.timestamp)}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Kid Solar Analysis:
${image.analysis}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí° Tip: Use "Copy for AI" to continue this conversation with Kid Solar!`;
      
      alert(details);
    }

    // Format conversation type for display
    function formatConversationType(type) {
      const typeMap = {
        'image-analysis': 'Image Analysis',
        'educational': 'Educational Discussion',
        'technical': 'Technical Deep Dive',
        'policy-analysis': 'Policy & Economics',
        'environmental': 'Environmental Impact',
        'maintenance': 'System Maintenance',
        'comparative-analysis': 'Technology Comparison',
        'economic-analysis': 'Financial Analysis',
        'future-tech': 'Future Technology',
        'hybrid-analysis': 'Hybrid Systems'
      };
      return typeMap[type] || 'General Conversation';
    }
    
    // Format timestamp
    function formatTimestamp(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }
    
    // Search functionality with enhanced criteria
    document.getElementById('searchInput').addEventListener('input', function() {
      const query = this.value.toLowerCase();
      filteredData = memoryData.filter(memory => 
        memory.preview.toLowerCase().includes(query) ||
        memory.topics.some(topic => topic.toLowerCase().includes(query)) ||
        memory.sessionId.toLowerCase().includes(query) ||
        (memory.fullConversation && memory.fullConversation.toLowerCase().includes(query)) ||
        (memory.images && memory.images.some(img => img.analysis.toLowerCase().includes(query)))
      );
      applySorting();
      updateStats();
      renderMemoryCards();
    });

    // Sort functionality
    document.getElementById('sortOrder').addEventListener('change', function() {
      applySorting();
      renderMemoryCards();
    });

    function applySorting() {
      const sortOrder = document.getElementById('sortOrder').value;
      
      switch(sortOrder) {
        case 'newest':
          filteredData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
          break;
        case 'oldest':
          filteredData.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
          break;
        case 'session-asc':
          filteredData.sort((a, b) => a.sessionId.localeCompare(b.sessionId));
          break;
        case 'session-desc':
          filteredData.sort((a, b) => b.sessionId.localeCompare(a.sessionId));
          break;
        case 'messages-desc':
          filteredData.sort((a, b) => (b.messages || 0) - (a.messages || 0));
          break;
        case 'images-desc':
          filteredData.sort((a, b) => (b.imageCount || 0) - (a.imageCount || 0));
          break;
        case 'conversation-type':
          filteredData.sort((a, b) => (a.conversationType || 'general').localeCompare(b.conversationType || 'general'));
          break;
      }
    }
    
    // Enhanced filter functionality with sorting integration
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        const now = new Date();
        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        
        switch(filter) {
          case 'all':
            filteredData = [...memoryData];
            break;
          case 'images':
            filteredData = memoryData.filter(memory => memory.hasImages);
            break;
          case 'recent':
            filteredData = memoryData.filter(memory => new Date(memory.timestamp) > sevenDaysAgo);
            break;
          case 'long':
            filteredData = memoryData.filter(memory => memory.messages > 10);
            break;
          case 'conversations':
            filteredData = memoryData.filter(memory => !memory.hasImages);
            break;
        }
        
        // Apply current search if any
        const searchQuery = document.getElementById('searchInput').value.toLowerCase();
        if (searchQuery) {
          filteredData = filteredData.filter(memory => 
            memory.preview.toLowerCase().includes(searchQuery) ||
            memory.topics.some(topic => topic.toLowerCase().includes(searchQuery)) ||
            memory.sessionId.toLowerCase().includes(searchQuery) ||
            (memory.fullConversation && memory.fullConversation.toLowerCase().includes(searchQuery)) ||
            (memory.images && memory.images.some(img => img.analysis.toLowerCase().includes(searchQuery)))
          );
        }
        
        applySorting();
        updateStats();
        renderMemoryCards();
      });
    });

    // Auto-apply sorting on initial load
    function initializeDisplay() {
      applySorting();
      updateStats();
      renderMemoryCards();
    }
    
    // Copy functionality
    function copyAnalysis(memoryIndex, imageIndex) {
      const analysis = filteredData[memoryIndex].images[imageIndex].analysis;
      copyToClipboard(analysis, `Copy Analysis`);
    }
    
    function copyForPrompt(memoryIndex, imageIndex) {
      const analysis = filteredData[memoryIndex].images[imageIndex].analysis;
      const promptText = `Previous image analysis for context:\n\n"${analysis}"\n\nPlease use this information to continue our conversation about renewable energy.`;
      copyToClipboard(promptText, `Copy for AI`);
    }
    
    function copyFullConversation(memoryIndex) {
      const conversation = filteredData[memoryIndex].fullConversation || filteredData[memoryIndex].preview;
      copyToClipboard(conversation, `Copy Conversation`);
    }
    
    function copyToClipboard(text, buttonText) {
      navigator.clipboard.writeText(text).then(() => {
        // Find the button that was clicked and show success feedback
        event.target.textContent = '‚úì Copied!';
        event.target.classList.add('copied');
        
        setTimeout(() => {
          event.target.textContent = buttonText;
          event.target.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy: ', err);
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        event.target.textContent = '‚úì Copied!';
        setTimeout(() => {
          event.target.textContent = buttonText;
        }, 2000);
      });
    }
    
    // Initialize
    loadMemoryData();
  </script>
</body>
</html>