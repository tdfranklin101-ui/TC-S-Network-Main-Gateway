<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Now - Monazite Catalog</title>
    <!-- Stripe.js for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #ff8c00;
        }
        
        h1 {
            text-align: center;
            color: #ff8c00;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .player-section {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(218, 165, 32, 0.1));
            border: 2px solid rgba(255, 140, 0, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .track-list {
            margin-bottom: 20px;
        }
        
        .track-button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            background: linear-gradient(135deg, #ff8c00, #ff6600);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .track-button:hover {
            background: linear-gradient(135deg, #ff6600, #ff4400);
            transform: translateY(-2px);
        }
        
        .track-button:active {
            transform: translateY(0);
        }
        
        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .now-playing {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            color: #ff8c00;
            font-weight: bold;
            font-size: 18px;
            margin: 15px 0;
            border: 2px solid #ff8c00;
            display: none;
        }
        
        .back-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .back-link a {
            color: #ff8c00;
            text-decoration: none;
            font-size: 18px;
            font-weight: bold;
            padding: 10px 20px;
            border: 2px solid #ff8c00;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .back-link a:hover {
            background: #ff8c00;
            color: black;
        }
        
        /* No locked styles needed - all tracks free for streaming */
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            margin: 10% auto;
            padding: 30px;
            border: 3px solid #ff8c00;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            color: white;
        }
        
        .modal h2 {
            color: #ff8c00;
            margin-bottom: 20px;
        }
        
        .modal p {
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        .modal-button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .wallet-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .wallet-button:hover {
            background: linear-gradient(135deg, #20c997, #17a2b8);
            transform: scale(1.05);
        }
        
        .close-button {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }
        
        .close-button:hover {
            background: linear-gradient(135deg, #c82333, #bd2130);
            transform: scale(1.05);
        }
        /* Timer UI styles removed - streaming is now free */
    </style>

    <!-- Progression system scripts removed - streaming is now free -->
    <script>
        // Configure Stripe (load from environment or use test key)
        // Use environment variable for Stripe publishable key (set by server)
        window.STRIPE_PUBLISHABLE_KEY = '{{STRIPE_PUBLISHABLE_KEY}}' || 'pk_test_placeholder';
    </script>
</head>
<body>
    <div class="container">
        <!-- Monazite Album Cover -->
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="/IMG_1377_1756882868979.jpeg" alt="Monazite Album Cover" style="width: 250px; height: auto; border-radius: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.5); border: 3px solid #ff8c00;">
        </div>
        
        <!-- Prominent Get Solar Banner -->
        <div style="background: linear-gradient(135deg, #ffff00, #ffd700); border-radius: 15px; padding: 20px; margin: 0 0 20px 0; text-align: center; border: 3px solid #ffa500; box-shadow: 0 6px 20px rgba(255,165,0,0.4);">
          <h2 style="color: black; margin: 0 0 10px 0; font-size: 1.5rem; font-weight: bold;">ğŸµ All Music Streams FREE!</h2>
          <p style="color: black; margin: 0 0 15px 0; font-size: 1rem; opacity: 0.9;">Download tracks for offline access with Solar</p>
          <a href="https://solar-artifacts-tdfranklin101.replit.app" data-testid="button-get-solar-music" style="display: inline-block; background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 12px 25px; border-radius: 12px; text-decoration: none; font-weight: bold; font-size: 1.1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(40,167,69,0.4);">
            ğŸš€ Get Solar Now - Free Registration
          </a>
        </div>
        
        <h1>ğŸµ MONAZITE MUSIC NOW COLLECTION ğŸµ</h1>
        <p style="text-align: center; font-size: 18px; margin-bottom: 20px;">
            Complete Catalog - 19 Tracks + 1 Bonus Market Track
        </p>
        
        <!-- Market Information Banner -->
        <div style="background: linear-gradient(135deg, rgba(0,123,255,0.1), rgba(40,167,69,0.1)); border: 2px solid #007bff; border-radius: 12px; padding: 20px; margin-bottom: 25px;">
            <div style="text-align: center; margin-bottom: 15px;">
                <h3 style="color: #007bff; margin: 0; font-size: 20px;">ğŸŒ TC-S Network Digital Artifact Solar Standard Market ğŸŒ</h3>
                <p style="color: #28a745; margin: 5px 0 0 0; font-weight: bold;">NOW OPEN FOR BUSINESS</p>
            </div>
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-size: 14px; line-height: 1.6;">
                <p style="margin: 0 0 10px 0;"><strong>ğŸµ Music Downloads:</strong> All tracks stream free here, downloads for offline access available at market</p>
                <p style="margin: 0 0 10px 0;"><strong>ğŸ’° Foundation Support:</strong> 25% surcharge on kWh footprints supports TC-S Networks Foundation Global Basic Income Network</p>
                <p style="margin: 0 0 10px 0;"><strong>ğŸŒ Network Solar:</strong> Solar has value within TC-S Network only - registration mandatory for in-Network Solar</p>
                <p style="margin: 0 0 10px 0;"><strong>ğŸ”’ Private Solarspheres:</strong> Separate Solar pools for Foundation GBI Network and PBC Commissioning Network systems</p>
                <p style="margin: 0; color: #ffd700;"><strong>ğŸš€ Member-Driven:</strong> Market categories extended to other site areas added by you, the members</p>
            </div>
        </div>
        
        <!-- Streaming vs Downloads Information -->
        <div style="background: linear-gradient(135deg, rgba(40,167,69,0.1), rgba(23,162,184,0.1)); border: 2px solid #28a745; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
            <h3 style="color: #28a745; margin: 0 0 15px 0; font-size: 18px;">ğŸ†“ STREAMING vs ğŸ’° DOWNLOADS</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 600px; margin: 0 auto;">
                <div style="background: rgba(40,167,69,0.2); padding: 15px; border-radius: 8px; border: 1px solid #28a745;">
                    <h4 style="color: #28a745; margin: 0 0 10px 0;">ğŸµ STREAMING</h4>
                    <p style="margin: 0; color: white; font-size: 14px;">â€¢ All tracks stream FREE<br>â€¢ No timers, no restrictions, no limits<br>â€¢ Unlimited replays and full catalog access<br>â€¢ AI recommendations included</p>
                </div>
                <div style="background: rgba(255,193,7,0.2); padding: 15px; border-radius: 8px; border: 1px solid #ffc107;">
                    <h4 style="color: #ffc107; margin: 0 0 10px 0;">ğŸ’¾ DOWNLOADS</h4>
                    <p style="margin: 0; color: white; font-size: 14px;">â€¢ Offline downloads require Solar registration<br>â€¢ Permanent file ownership through Solar market<br>â€¢ Support artist & platform<br>â€¢ Register at wallet.market</p>
                </div>
            </div>
        </div>
        
        <div class="player-section">
            <div class="track-list">
                <button class="track-button" data-testid="track-button-0" onclick="playTrack(0)">ğŸ”¥ 'Ternal Flame - Longevity Manifesto</button>
                
                <!-- 'Ternal Flame Graphic -->
                <div style="text-align: center; margin: 10px 0;">
                  <img src="IMG_1472_1757436204528.jpeg" alt="'Ternal Flame - Longevity Manifesto" style="width: 200px; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); border: 2px solid #ff8c00;">
                  <div style="margin-top: 8px; padding: 8px; background: rgba(255,140,0,0.1); border: 1px solid rgba(255,140,0,0.3); border-radius: 8px;">
                    <span style="color: #ff8c00; font-style: italic;">ğŸµ Song 19 - Latest Addition</span>
                  </div>
                </div>
                
                <button class="track-button" data-testid="track-button-1" onclick="playTrack(1)">â­ David Boyeez Hair</button>
                
                <!-- Bowie Graphics for David Boyeez Hair -->
                <div style="display: flex; gap: 15px; margin: 10px 0 20px 0; justify-content: center;">
                  <img src="/04AA9BAB-9CBA-43ED-A1B5-E4674F850D59_1756066851257.png" alt="Changes" style="width: 100px; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
                  <img src="/5906466E-3563-443A-8273-19DB5D24F116_1756066851257.png" alt="Ch-Ch-Ch-Changes" style="width: 100px; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
                </div>
                <button class="track-button" data-testid="track-button-2" onclick="playTrack(2)">ğŸŠ Swampy Boogie Nights (Cajun Crawler)</button>
                <button class="track-button" data-testid="track-button-3" onclick="playTrack(3)">ğŸµ The Heart is a Mule (by Robert Hunter, Allen Ginsberg and William Burroughs)</button>
                <button class="track-button" data-testid="track-button-4" onclick="playTrack(4)">ğŸ¶ A Solar Day (groovin)</button>
                <button class="track-button" data-testid="track-button-5" onclick="playTrack(5)">ğŸ¼ A Solar Day (moovin)</button>
                <button class="track-button" data-testid="track-button-6" onclick="playTrack(6)">ğŸº Break Time Blues Rhapsody (By Kid Solar)</button>
                <button class="track-button" data-testid="track-button-7" onclick="playTrack(7)">â­ Starlight Forever - Experience the full orchestral version</button>
                <button class="track-button" data-testid="track-button-8" onclick="playTrack(8)">ğŸ’¡ Light It From Within - Exclusive meditation mix</button>
                <button class="track-button" data-testid="track-button-9" onclick="playTrack(9)">ğŸŒ™ Moonshine in St Kitts - By Bowie, Jagger, Lennon</button>
                <button class="track-button" data-testid="track-button-10" onclick="playTrack(10)">âš¡ Solar Tempest Symphony (By JMF)</button>
                <button class="track-button" data-testid="track-button-11" onclick="playTrack(11)">ğŸ”© Steel In His Soul</button>
                <button class="track-button" data-testid="track-button-12" onclick="playTrack(12)">ğŸ’¬ We Said So</button>
                <button class="track-button" data-testid="track-button-13" onclick="playTrack(13)">ğŸ—¿ Funky Voodoo (Blues Jam)</button>
                <button class="track-button" data-testid="track-button-14" onclick="playTrack(14)">ğŸ—¿ Green and Blue (Rock)</button>
                <button class="track-button" data-testid="track-button-15" onclick="playTrack(15)">ğŸ—¿ Green and Blue (EDM)</button>
                <button class="track-button" data-testid="track-button-16" onclick="playTrack(16)">ğŸ—¿ Lady Voodoo (Folk Yah)</button>
                <button class="track-button" data-testid="track-button-17" onclick="playTrack(17)">ğŸ—¿ Lady Voodoo (Crying)</button>
                <button class="track-button" data-testid="track-button-18" onclick="playTrack(18)">ğŸ—¿ Rasta Lady Voodoo</button>
                
                <!-- Bonus Market Track -->
                <div style="margin: 20px 0; padding: 15px; background: rgba(255,215,0,0.1); border: 2px solid #ffd700; border-radius: 10px;">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <span style="color: #ffd700; font-weight: bold; font-size: 16px;">ğŸ’ BONUS MARKET EXCLUSIVE ğŸ’</span>
                    </div>
                    <button class="track-button" data-testid="track-button-bonus" onclick="playTrack(19)" style="background: linear-gradient(135deg, #ffd700, #ffb300); color: #1a1a2e;">â„ï¸ Snowmancer One (Market Exclusive)</button>
                    <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #ffd700;">
                        Available only through Solar trading at solar-artifacts-tdfranklin101.replit.app
                    </div>
                </div>
            </div>
            
            <!-- Play Album Button -->
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="playAlbum()" id="albumButton" data-testid="button-play-album" style="padding: 15px 30px; background: linear-gradient(135deg, #ff6600, #ff4400); border: none; border-radius: 10px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
                    ğŸµ Play Album (Random, No Repeats)
                </button>
            </div>

            <div class="now-playing" id="nowPlaying">
                ğŸ¶ Now Playing: <span id="trackName">Select a track</span>
            </div>
            
            <audio id="audioPlayer" class="audio-player" data-testid="audio-player" controls preload="none">
                Your browser does not support the audio element.
            </audio>
        </div>
        
        <!-- AI Music Intelligence Dashboard -->
        <div id="ai-music-dashboard" style="margin: 30px 0;">
            <h2 style="text-align: center; color: #ff8c00; margin-bottom: 25px;">ğŸ¤– AI Music Intelligence</h2>
            
            <!-- AI Recommendations Section -->
            <div style="background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(218, 165, 32, 0.1)); border: 2px solid rgba(255, 140, 0, 0.3); border-radius: 15px; padding: 25px; margin-bottom: 20px;">
                <h3 style="color: #ff8c00; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="font-size: 1.5rem; margin-right: 10px;">ğŸ¯</span>
                    Personalized Recommendations
                </h3>
                <div id="ai-recommendations" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <div class="loading-placeholder" style="text-align: center; color: #adb5bd; font-style: italic; padding: 20px;">
                        AI is analyzing your music preferences...
                    </div>
                </div>
            </div>

            <!-- Market Intelligence Section -->
            <div style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1), rgba(40, 167, 69, 0.1)); border: 2px solid #007bff; border-radius: 15px; padding: 25px; margin-bottom: 20px;">
                <h3 style="color: #007bff; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="font-size: 1.5rem; margin-right: 10px;">ğŸ“ˆ</span>
                    Market Intelligence
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <!-- Price Trends -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px;">
                        <h4 style="color: #28a745; margin: 0 0 10px 0;">ğŸ’° Pricing Trends</h4>
                        <div id="pricing-trends">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span>Track Avg Price:</span>
                                <span style="color: #ff8c00; font-weight: bold;" id="avg-price">S0.1000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span>Market Volume:</span>
                                <span style="color: #28a745; font-weight: bold;" id="market-volume">â†— 45.3K plays</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Top Genre:</span>
                                <span style="color: #ffd700; font-weight: bold;" id="top-genre">Blues Rock</span>
                            </div>
                        </div>
                    </div>

                    <!-- Demand Forecast -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px;">
                        <h4 style="color: #007bff; margin: 0 0 10px 0;">ğŸµ Popular Right Now</h4>
                        <div id="demand-forecast">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span>1. 'Ternal Flame</span>
                                <span style="color: #ff4400;">ğŸ”¥ +127%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span>2. David Boyeez Hair</span>
                                <span style="color: #ff6600;">â­ +89%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>3. Starlight Forever</span>
                                <span style="color: #ff8c00;">ğŸ“ˆ +62%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Purchase Optimizer -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px;">
                        <h4 style="color: #ffd700; margin: 0 0 10px 0;">ğŸ’¡ Purchase Optimizer</h4>
                        <div id="purchase-optimizer">
                            <div style="background: rgba(40, 167, 69, 0.2); border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                                <div style="font-size: 0.9rem; color: #28a745; font-weight: bold;">Best Time to Buy</div>
                                <div style="font-size: 0.8rem; margin-top: 4px;">Next 2 hours: Peak demand expected</div>
                            </div>
                            <div style="background: rgba(255, 215, 0, 0.2); border-radius: 6px; padding: 10px;">
                                <div style="font-size: 0.9rem; color: #ffd700; font-weight: bold;">Bundle Suggestion</div>
                                <div style="font-size: 0.8rem; margin-top: 4px;">Buy 5 tracks: Save 15% Solar</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Creator Insights (for content creators) -->
            <div id="creator-insights" style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.1)); border: 2px solid #8a2be2; border-radius: 15px; padding: 25px; margin-bottom: 20px; display: none;">
                <h3 style="color: #8a2be2; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="font-size: 1.5rem; margin-right: 10px;">ğŸ¨</span>
                    Creator Dashboard
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px;">
                        <h4 style="color: #da70d6; margin: 0 0 10px 0;">ğŸ“Š Your Track Performance</h4>
                        <canvas id="performance-chart" width="200" height="120" style="width: 100%; height: auto;"></canvas>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px;">
                        <h4 style="color: #9370db; margin: 0 0 10px 0;">ğŸ¯ Optimize Pricing</h4>
                        <div id="pricing-suggestions">
                            <div style="margin-bottom: 8px;">Suggested: <strong style="color: #8a2be2;">S0.0850</strong></div>
                            <div style="margin-bottom: 8px; font-size: 0.9rem; color: #aaa;">Based on genre trends</div>
                            <button onclick="applyAIPricing()" style="background: #8a2be2; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Apply AI Pricing</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Music Discovery Assistant -->
            <div style="background: linear-gradient(135deg, rgba(255, 20, 147, 0.1), rgba(199, 21, 133, 0.1)); border: 2px solid #ff1493; border-radius: 15px; padding: 25px; margin-bottom: 20px;">
                <h3 style="color: #ff1493; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="font-size: 1.5rem; margin-right: 10px;">ğŸ§</span>
                    AI Music Discovery
                </h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                    <button onclick="discoverByMood('energetic')" style="background: #ff6347; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.3s;">ğŸ”¥ Energetic</button>
                    <button onclick="discoverByMood('chill')" style="background: #4682b4; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.3s;">ğŸ˜Œ Chill</button>
                    <button onclick="discoverByMood('nostalgic')" style="background: #daa520; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.3s;">ğŸŒ… Nostalgic</button>
                    <button onclick="discoverByMood('experimental')" style="background: #8a2be2; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.3s;">ğŸ”¬ Experimental</button>
                    <button onclick="askAI()" style="background: #ff1493; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.3s;">ğŸ¤– Ask AI</button>
                </div>
                <div id="discovery-results" style="min-height: 60px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 15px;">
                    <p style="margin: 0; color: #aaa; font-style: italic;">Select a mood above or ask AI to discover music tailored to your preferences</p>
                </div>
            </div>
        </div>

        <!-- Market Status Footer -->
        <div style="background: rgba(40,167,69,0.1); border: 2px solid #28a745; border-radius: 10px; padding: 15px; margin: 20px 0; text-align: center;">
            <p style="margin: 0; color: #28a745; font-weight: bold; font-size: 16px;">ğŸ† TC-S Network Digital Artifact Market: OPERATIONAL</p>
            <p style="margin: 5px 0 0 0; font-size: 14px;">Expanding to new categories and site areas through member contributions</p>
        </div>
        
        <div class="back-link">
            <a href="/">â† Back to Current-See Platform</a>
        </div>
    </div>

    <!-- AI Music Assistant Chat Trigger -->
    <button id="music-ai-chat-trigger" style="position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: linear-gradient(135deg, #ff1493, #c71585); border-radius: 50%; border: none; cursor: pointer; box-shadow: 0 4px 20px rgba(255, 20, 147, 0.4); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; transition: all 0.3s ease; z-index: 1000;" title="Ask AI Music Assistant">
        ğŸ¤
    </button>

    <!-- Wallet Modal -->
    <div id="walletModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ’¾ Download Available</h2>
            <p>Streaming is completely FREE with unlimited replays!</p>
            <p>For offline downloads, register for Solar tokens at solar-artifacts-tdfranklin101.replit.app:</p>
            <div style="background: rgba(255,140,0,0.1); padding: 15px; border-radius: 10px; margin: 20px 0; border: 2px solid #ff8c00;">
                <p style="margin: 0; color: #ff8c00; font-weight: bold;">ğŸ’¾ Download Cost: S0.1000 Solar</p>
                <p style="margin: 5px 0 0 0; font-size: 14px;">Streaming is FREE - Download requires Solar registration</p>
                <p style="margin: 8px 0 0 0; color: #ffff00; font-size: 13px; font-weight: bold;">âš¡ Don't have Solar? Get 1 free per day!</p>
                <div style="margin: 10px 0; padding: 8px; background: rgba(40,167,69,0.1); border-radius: 6px; border: 1px solid #28a745;">
                  <p style="margin: 0; color: #28a745; font-size: 11px; font-weight: bold;">ğŸµ Streaming is completely FREE! Downloads require Solar registration.</p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button wallet-button" data-testid="button-trade-solar" onclick="goToWallet()">ğŸš€ Trade Solar at wallet.market</button>
                <button class="modal-button" data-testid="button-get-solar-modal" onclick="window.open('https://solar-artifacts-tdfranklin101.replit.app', '_blank'); closeModal();" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; margin: 5px;">âš¡ Get Free Solar</button>
                <button class="modal-button close-button" data-testid="button-close-modal" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // MP3 track URLs
        const tracks = [
            'https://storage.aisongmaker.io/audio/4a839c86-40d9-4272-989b-7a512184ddb6.mp3', // 'Ternal Flame - Longevity Manifesto
            'https://storage.aisongmaker.io/audio/9b2b12e4-8626-41e4-b9e4-c7a563e40f97.mp3', // David Boyeez Hair
            'https://storage.aisongmaker.io/audio/015092c3-f687-4a01-9a81-dad42f2adce9.mp3', // Swampy Boogie Nights  
            'https://storage.aisongmaker.io/audio/10db8911-0b74-4675-ba62-02182c1d7f6b.mp3', // The Heart is a Mule
            'https://storage.aisongmaker.io/audio/418add3e-c1a5-4a76-b361-14d6a11794fe.mp3', // A Solar Day (groovin)
            'https://storage.aisongmaker.io/audio/a2647129-991f-4105-aad2-e45210005bef.mp3', // A Solar Day (moovin)
            'https://storage.aisongmaker.io/audio/09de8c9d-25a7-4b38-a6bd-c27b7de4629e.mp3', // Break Time Blues Rhapsody
            'https://storage.aisongmaker.io/audio/c51b1f15-eff7-41fb-b778-b1b9d914ce3a.mp3', // Starlight Forever
            'https://storage.aisongmaker.io/audio/ab1612d5-ccf4-4b4a-ab92-21b77bebdd46.mp3', // Light It From Within
            'https://storage.aisongmaker.io/audio/675d577c-5ab9-45c9-b9d5-d4362f6bcc12.mp3', // Moonshine in St Kitts
            'https://storage.aisongmaker.io/audio/94088af1-8318-401a-b277-b79fbbdb7475.mp3', // Solar Tempest Symphony
            'https://storage.aisongmaker.io/audio/cb58c04e-fc7b-448a-a9e5-a642e168cacd.mp3', // Steel In His Soul
            'https://storage.aisongmaker.io/audio/11802549-7cf8-4d4c-a708-44f04804f2ab.mp3', // We Said So
            'https://storage.aisongmaker.io/audio/19d37c35-dc0b-4686-8bd7-71992f925670.mp3', // Funky Voodoo
            'https://storage.aisongmaker.io/audio/255be09f-c09a-4d9a-8dbc-3c3ba65e9204.mp3', // Green and Blue (Rock)
            'https://storage.aisongmaker.io/audio/01e05fb6-a7ac-4dd3-9500-00bb46625ef1.mp3', // Green and Blue (EDM)
            'https://storage.aisongmaker.io/audio/49fc3427-e775-47f0-b5ea-8903006b07a0.mp3', // Lady Voodoo (Folk)
            'https://storage.aisongmaker.io/audio/b2001c35-620a-4893-b046-4de20ad11422.mp3', // Lady Voodoo (Crying)
            'https://storage.aisongmaker.io/audio/7abf4dac-2b12-434a-8d59-c115f8c54cb9.mp3', // Rasta Lady Voodoo
            'https://storage.aisongmaker.io/audio/b72acaea-72b4-4dc2-8c84-98e0b30a82e3.mp3'  // Snowmancer One (Bonus)
        ];

        const trackNames = [
            'ğŸ”¥ \'Ternal Flame - Longevity Manifesto', 'â­ David Boyeez Hair', 'ğŸŠ Swampy Boogie Nights (Cajun Crawler)', 
            'ğŸµ The Heart is a Mule', 'ğŸ¶ A Solar Day (groovin)', 'ğŸ¼ A Solar Day (moovin)',
            'ğŸº Break Time Blues Rhapsody', 'â­ Starlight Forever', 'ğŸ’¡ Light It From Within',
            'ğŸŒ™ Moonshine in St Kitts', 'âš¡ Solar Tempest Symphony', 'ğŸ”© Steel In His Soul',
            'ğŸ’¬ We Said So', 'ğŸ—¿ Funky Voodoo (Blues Jam)', 'ğŸ—¿ Green and Blue (Rock)',
            'ğŸ—¿ Green and Blue (EDM)', 'ğŸ—¿ Lady Voodoo (Folk Yah)', 'ğŸ—¿ Lady Voodoo (Crying)', 
            'ğŸ—¿ Rasta Lady Voodoo',
            'â„ï¸ Snowmancer One (Market Exclusive)'
        ];

        // Album playback variables
        let albumMode = false;
        let shuffledTracks = [];
        let currentAlbumIndex = 0;
        
        // Track play history management
        function getPlayHistory() {
            return JSON.parse(localStorage.getItem('monazite_play_history') || '[]');
        }
        
        function markTrackPlayed(index) {
            const history = getPlayHistory();
            if (!history.includes(index)) {
                history.push(index);
                localStorage.setItem('monazite_play_history', JSON.stringify(history));
                updateTrackButtons();
            }
        }
        
        function isTrackPlayed(index) {
            return getPlayHistory().includes(index);
        }
        
        function updateTrackButtons() {
            // NO RESTRICTIONS - ALL TRACKS ALWAYS AVAILABLE FOR STREAMING
            const buttons = document.querySelectorAll('.track-button');
            buttons.forEach((button, index) => {
                button.classList.remove('locked');
                // Ensure all buttons work for streaming
                button.onclick = () => playTrack(index);
            });
        }
        
        function showWalletModal(index) {
            document.getElementById('walletModal').style.display = 'block';
        }
        
        function showBonusTrackModal() {
            // Show specialized modal for bonus track
            const modal = document.getElementById('walletModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <h2>ğŸµ Free Streaming Available!</h2>
                <div style="margin: 20px 0;">
                    <h3 style="color: #ffd700; margin-bottom: 15px;">â„ï¸ Snowmancer One</h3>
                    <p>Stream this track unlimited times for FREE!</p>
                    <p>For offline downloads, register for Solar tokens - <strong>no cash or credit cards required</strong>.</p>
                </div>
                <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; margin: 20px 0; border: 2px solid #ffd700;">
                    <p style="margin: 0; color: #ffd700; font-weight: bold;">ğŸ’¾ Download Access: S0.0250 Solar</p>
                    <p style="margin: 5px 0 0 0; font-size: 14px;">Streaming FREE - Downloads through Solar registration only</p>
                </div>
                <div style="background: rgba(40,167,69,0.1); padding: 10px; border-radius: 8px; margin: 15px 0; border: 1px solid #28a745;">
                    <p style="margin: 0; color: #28a745; font-size: 14px; font-weight: bold;">âœ… 100% Free Streaming</p>
                    <p style="margin: 3px 0 0 0; font-size: 12px; color: #ffffff;">No restrictions, no timers, unlimited replays</p>
                </div>
                <div class="modal-buttons">
                    <button class="modal-button wallet-button" data-testid="button-trade-solar-bonus" onclick="goToWallet()">ğŸš€ Get Solar at wallet.market</button>
                    <button class="modal-button close-button" data-testid="button-close-modal" onclick="closeModal()">Cancel</button>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('walletModal').style.display = 'none';
        }
        
        function goToWallet() {
            window.open('https://solar-artifacts-tdfranklin101.replit.app', '_blank');
            closeModal();
        }
        
        // Initialize track button states when page loads - ensure no restrictions
        window.addEventListener('load', function() {
            // Remove any existing locks and ensure all tracks are playable
            const buttons = document.querySelectorAll('.track-button');
            buttons.forEach((button, index) => {
                button.classList.remove('locked');
                button.onclick = () => playTrack(index);
            });
        });

        function playTrack(index) {
            // FREE STREAMING - NO RESTRICTIONS!
            const player = document.getElementById('audioPlayer');
            const nowPlaying = document.getElementById('nowPlaying');
            const trackName = document.getElementById('trackName');
            
            // Load the track
            player.src = tracks[index];
            player.load();
            
            // Update display
            trackName.textContent = trackNames[index];
            nowPlaying.style.display = 'block';
            
            // Try to play (may be blocked by autoplay policy)
            player.play().catch(() => {
                // Autoplay blocked - user can use controls
            });
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function playAlbum() {
            const button = document.getElementById('albumButton');
            const player = document.getElementById('audioPlayer');
            
            if (!albumMode) {
                // Start album mode
                albumMode = true;
                shuffledTracks = shuffleArray([...Array(19).keys()]); // [0,1,2...18] shuffled (excluding bonus track)
                currentAlbumIndex = 0;
                button.textContent = 'â¹ï¸ Stop Album';
                button.style.background = 'linear-gradient(135deg, #dc143c, #b91c3c)';
                
                // Play first track
                playTrack(shuffledTracks[currentAlbumIndex]);
                
                // Set up auto-advance
                player.addEventListener('ended', autoAdvanceTrack);
            } else {
                // Stop album mode
                stopAlbum();
            }
        }

        function stopAlbum() {
            const button = document.getElementById('albumButton');
            const player = document.getElementById('audioPlayer');
            
            albumMode = false;
            button.textContent = 'ğŸµ Play Album (Random, No Repeats)';
            button.style.background = 'linear-gradient(135deg, #ff6600, #ff4400)';
            
            // Remove event listener
            player.removeEventListener('ended', autoAdvanceTrack);
            player.pause();
        }

        function autoAdvanceTrack() {
            if (!albumMode) return;
            
            currentAlbumIndex++;
            
            if (currentAlbumIndex >= shuffledTracks.length) {
                // Album finished
                stopAlbum();
                const trackName = document.getElementById('trackName');
                trackName.textContent = 'Album Complete! ğŸ‰';
                return;
            }
            
            // Play next track
            setTimeout(() => {
                playTrack(shuffledTracks[currentAlbumIndex]);
            }, 1000); // 1 second gap between tracks
        }

        // ========== AI Music Intelligence System ==========
        
        class MusicAIDashboard {
            constructor() {
                this.apiBase = '/api/ai';
                this.isLoading = false;
                this.userPreferences = this.loadUserPreferences();
                this.init();
            }

            async init() {
                try {
                    // Initialize AI chat interface
                    this.initAIChatInterface();
                    
                    // Load AI insights
                    await Promise.all([
                        this.loadPersonalizedRecommendations(),
                        this.updateMarketIntelligence(),
                        this.initCreatorDashboard()
                    ]);

                    // Set up event listeners
                    this.setupEventListeners();

                    console.log('âœ… Music AI Dashboard initialized successfully');
                } catch (error) {
                    console.error('âŒ Failed to initialize Music AI Dashboard:', error);
                }
            }

            initAIChatInterface() {
                const chatTrigger = document.getElementById('music-ai-chat-trigger');
                if (chatTrigger) {
                    chatTrigger.addEventListener('click', () => {
                        this.openMusicAIChat();
                    });

                    // Hover effects
                    chatTrigger.addEventListener('mouseenter', () => {
                        chatTrigger.style.transform = 'scale(1.1)';
                        chatTrigger.style.boxShadow = '0 6px 25px rgba(255, 20, 147, 0.6)';
                    });
                    
                    chatTrigger.addEventListener('mouseleave', () => {
                        chatTrigger.style.transform = 'scale(1)';
                        chatTrigger.style.boxShadow = '0 4px 20px rgba(255, 20, 147, 0.4)';
                    });
                }

                // Initialize AI chat interface if available
                if (window.AIChatInterface) {
                    this.musicAI = new AIChatInterface({
                        containerId: 'music-ai-chat',
                        triggerId: 'music-ai-chat-trigger',
                        apiBaseUrl: this.apiBase,
                        enableVoice: true,
                        enableImageAnalysis: true,
                        theme: 'music',
                        context: 'music_discovery'
                    });
                }
            }

            openMusicAIChat() {
                if (this.musicAI) {
                    this.musicAI.open();
                } else {
                    // Fallback: Create simple chat modal
                    this.createSimpleChatModal();
                }
            }

            createSimpleChatModal() {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.8); z-index: 2000; display: flex;
                    align-items: center; justify-content: center;
                `;
                
                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); 
                                border: 3px solid #ff1493; border-radius: 15px; 
                                width: 90%; max-width: 500px; padding: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: #ff1493; margin: 0;">ğŸ¤ AI Music Assistant</h2>
                            <button onclick="this.closest('div').remove()" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">Ã—</button>
                        </div>
                        <div style="height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; margin-bottom: 15px;" id="chat-messages">
                            <div style="color: #ff1493; margin-bottom: 10px;">ğŸ¤– Hi! I'm your AI Music Assistant. I can help you discover new tracks, optimize your listening experience, and provide personalized recommendations!</div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" placeholder="Ask me about music..." style="flex: 1; padding: 10px; border-radius: 6px; border: 2px solid #ff1493; background: rgba(255,255,255,0.1); color: white;" id="chat-input">
                            <button onclick="musicAIDashboard.sendChatMessage()" style="background: #ff1493; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Send</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                document.getElementById('chat-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChatMessage();
                });
            }

            async sendChatMessage() {
                const input = document.getElementById('chat-input');
                const messages = document.getElementById('chat-messages');
                
                if (!input || !messages || !input.value.trim()) return;
                
                const userMessage = input.value.trim();
                input.value = '';
                
                // Add user message
                messages.innerHTML += `<div style="margin-bottom: 10px; text-align: right;"><span style="background: #ff1493; padding: 8px 12px; border-radius: 12px; color: white;">${userMessage}</span></div>`;
                
                // Add AI response
                messages.innerHTML += `<div style="margin-bottom: 10px;"><span style="background: rgba(255,20,147,0.2); padding: 8px 12px; border-radius: 12px; color: #ff1493;">ğŸ¤– ${this.generateAIResponse(userMessage)}</span></div>`;
                
                messages.scrollTop = messages.scrollHeight;
            }

            generateAIResponse(message) {
                const responses = [
                    `Based on your question about "${message}", I'd recommend exploring the Blues Rock section - especially 'Ternal Flame and David Boyeez Hair!`,
                    `Great question! For your music taste, I suggest trying the experimental tracks like Funky Voodoo and Solar Tempest Symphony.`,
                    `I can see you're interested in "${message}". The Monazite collection has some amazing variety - try the mood-based discovery buttons!`,
                    `That's a fantastic query! Based on current trends, Starlight Forever and Moonshine in St Kitts are really popular right now.`,
                    `Interesting! For "${message}", I'd recommend starting with A Solar Day (both versions) to get a feel for the collection's range.`
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            async loadPersonalizedRecommendations() {
                try {
                    const response = await fetch(`${this.apiBase}/content-recommendations`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({
                            contentTypes: ['music_track'],
                            maxRecommendations: 6,
                            context: 'music_platform'
                        })
                    });

                    if (response.ok) {
                        const recommendations = await response.json();
                        this.displayRecommendations(recommendations);
                    } else {
                        this.showPlaceholderRecommendations();
                    }
                } catch (error) {
                    console.error('Error loading recommendations:', error);
                    this.showPlaceholderRecommendations();
                }
            }

            displayRecommendations(recommendations) {
                const container = document.getElementById('ai-recommendations');
                if (!container) return;

                if (recommendations.recommendations && recommendations.recommendations.length > 0) {
                    container.innerHTML = recommendations.recommendations.map(rec => `
                        <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; border: 2px solid rgba(255,140,0,0.3);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 1.5rem; margin-right: 10px;">${this.getRecommendationIcon(rec.action)}</span>
                                <h4 style="margin: 0; color: #ff8c00;">${rec.action}</h4>
                            </div>
                            <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.9rem;">${rec.reasoning || 'AI recommends this based on your listening patterns'}</p>
                            <button onclick="musicAIDashboard.handleRecommendation('${rec.action}')" style="background: #ff8c00; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: all 0.3s;">Try Now</button>
                        </div>
                    `).join('');
                } else {
                    this.showPlaceholderRecommendations();
                }
            }

            showPlaceholderRecommendations() {
                const container = document.getElementById('ai-recommendations');
                if (!container) return;

                container.innerHTML = `
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; border: 2px solid rgba(255,140,0,0.3);">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <span style="font-size: 1.5rem; margin-right: 10px;">ğŸ”¥</span>
                            <h4 style="margin: 0; color: #ff8c00;">Trending Now: 'Ternal Flame</h4>
                        </div>
                        <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.9rem;">This track is gaining popularity - your listening history suggests you'll love it!</p>
                        <button onclick="playTrack(0)" style="background: #ff8c00; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Play Now</button>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; border: 2px solid rgba(255,140,0,0.3);">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <span style="font-size: 1.5rem; margin-right: 10px;">â­</span>
                            <h4 style="margin: 0; color: #ff8c00;">Perfect Match: David Boyeez Hair</h4>
                        </div>
                        <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.9rem;">AI detected 94% compatibility with your music preferences</p>
                        <button onclick="playTrack(1)" style="background: #ff8c00; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Listen</button>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; border: 2px solid rgba(255,140,0,0.3);">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <span style="font-size: 1.5rem; margin-right: 10px;">ğŸµ</span>
                            <h4 style="margin: 0; color: #ff8c00;">Hidden Gem Discovery</h4>
                        </div>
                        <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.9rem;">Based on your taste profile: Break Time Blues Rhapsody</p>
                        <button onclick="playTrack(6)" style="background: #ff8c00; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Discover</button>
                    </div>
                `;
            }

            async updateMarketIntelligence() {
                try {
                    const response = await fetch(`${this.apiBase}/market-overview?timeframe=7&contentTypes=music`, {
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const marketData = await response.json();
                        this.updateMarketDisplays(marketData);
                    }
                } catch (error) {
                    console.error('Error loading market data:', error);
                    // Market display already has placeholder data
                }
            }

            updateMarketDisplays(marketData) {
                if (marketData.pricing_analysis) {
                    const avgPrice = document.getElementById('avg-price');
                    if (avgPrice) avgPrice.textContent = `S${marketData.pricing_analysis.average_price || '0.1000'}`;
                }

                if (marketData.market_summary) {
                    const volume = document.getElementById('market-volume');
                    const trend = marketData.market_summary.trend_direction;
                    if (volume) {
                        volume.textContent = `${trend === 'growing' ? 'â†—' : trend === 'declining' ? 'â†˜' : 'â†’'} ${marketData.market_summary.total_volume || '45.3K'} plays`;
                    }
                }
            }

            async initCreatorDashboard() {
                // Show creator insights if user is a content creator
                const creatorInsights = document.getElementById('creator-insights');
                if (creatorInsights && this.isContentCreator()) {
                    creatorInsights.style.display = 'block';
                    await this.loadCreatorAnalytics();
                }
            }

            isContentCreator() {
                // Check if user has creator permissions - for demo, randomly show it
                return Math.random() > 0.7; // 30% chance to show creator dashboard
            }

            async loadCreatorAnalytics() {
                const canvas = document.getElementById('performance-chart');
                if (!canvas) return;

                // Create simple performance chart
                const ctx = canvas.getContext('2d');
                
                // Sample data for demo
                const data = {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Track Plays',
                        data: [12, 19, 8, 25, 22, 15, 28],
                        borderColor: '#8a2be2',
                        backgroundColor: 'rgba(138, 43, 226, 0.1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                };

                // Simple manual chart drawing since Chart.js might not be available
                this.drawSimpleChart(ctx, data);
            }

            drawSimpleChart(ctx, data) {
                const width = ctx.canvas.width;
                const height = ctx.canvas.height;
                const padding = 20;
                
                ctx.clearRect(0, 0, width, height);
                
                // Draw background
                ctx.fillStyle = 'rgba(138, 43, 226, 0.1)';
                ctx.fillRect(0, 0, width, height);
                
                // Draw simple line chart
                ctx.strokeStyle = '#8a2be2';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const maxValue = Math.max(...data.datasets[0].data);
                const stepX = (width - 2 * padding) / (data.labels.length - 1);
                const stepY = (height - 2 * padding) / maxValue;
                
                data.datasets[0].data.forEach((value, index) => {
                    const x = padding + index * stepX;
                    const y = height - padding - value * stepY;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
            }

            // Mood-based discovery functions
            async discoverByMood(mood) {
                const resultsContainer = document.getElementById('discovery-results');
                if (!resultsContainer) return;

                resultsContainer.innerHTML = `<p style="margin: 0; color: #ff1493; font-style: italic;">ğŸ” Analyzing ${mood} tracks...</p>`;

                // Simulate AI processing delay
                setTimeout(() => {
                    const moodRecommendations = this.getMoodBasedRecommendations(mood);
                    resultsContainer.innerHTML = `
                        <h4 style="color: #ff1493; margin: 0 0 10px 0;">ğŸµ ${mood.charAt(0).toUpperCase() + mood.slice(1)} Picks</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            ${moodRecommendations.map(rec => `
                                <button onclick="playTrack(${rec.index})" style="background: rgba(255,20,147,0.2); color: #ff1493; border: 1px solid #ff1493; padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#ff1493'; this.style.color='white';" onmouseout="this.style.background='rgba(255,20,147,0.2)'; this.style.color='#ff1493';">
                                    ${rec.emoji} ${rec.title}
                                </button>
                            `).join('')}
                        </div>
                        <p style="margin: 10px 0 0 0; color: #aaa; font-size: 0.9rem;">AI selected these tracks based on ${mood} characteristics and your listening history.</p>
                    `;
                }, 1000);
            }

            getMoodBasedRecommendations(mood) {
                const moodMappings = {
                    energetic: [
                        { index: 0, title: "'Ternal Flame", emoji: "ğŸ”¥" },
                        { index: 10, title: "Solar Tempest Symphony", emoji: "âš¡" },
                        { index: 14, title: "Green and Blue (Rock)", emoji: "ğŸ—¿" }
                    ],
                    chill: [
                        { index: 4, title: "A Solar Day (groovin)", emoji: "ğŸ¶" },
                        { index: 8, title: "Light It From Within", emoji: "ğŸ’¡" },
                        { index: 16, title: "Lady Voodoo (Folk)", emoji: "ğŸ—¿" }
                    ],
                    nostalgic: [
                        { index: 1, title: "David Boyeez Hair", emoji: "â­" },
                        { index: 9, title: "Moonshine in St Kitts", emoji: "ğŸŒ™" },
                        { index: 3, title: "The Heart is a Mule", emoji: "ğŸµ" }
                    ],
                    experimental: [
                        { index: 13, title: "Funky Voodoo", emoji: "ğŸ—¿" },
                        { index: 15, title: "Green and Blue (EDM)", emoji: "ğŸ—¿" },
                        { index: 18, title: "Rasta Lady Voodoo", emoji: "ğŸ—¿" }
                    ]
                };
                
                return moodMappings[mood] || moodMappings.energetic;
            }

            askAI() {
                this.openMusicAIChat();
            }

            applyAIPricing() {
                alert('ğŸ¤– AI Pricing Applied! New suggested price: S0.0850 based on current market trends and genre performance.');
            }

            handleRecommendation(action) {
                if (this.musicAI) {
                    this.musicAI.sendQuery(`Tell me more about: ${action}`);
                } else {
                    console.log('Handling recommendation:', action);
                    alert(`ğŸ¤– AI Recommendation: ${action}\n\nThis feature would provide detailed insights about this recommendation in a full implementation.`);
                }
            }

            getRecommendationIcon(action) {
                const icons = {
                    'trending_track': 'ğŸ”¥',
                    'perfect_match': 'â­',
                    'hidden_gem': 'ğŸµ',
                    'playlist_add': 'ğŸ“',
                    'similar_artist': 'ğŸ¤',
                    'mood_match': 'ğŸ­'
                };
                return icons[action] || 'ğŸ’¡';
            }

            setupEventListeners() {
                // Add listener for track plays to update AI recommendations
                const audioPlayer = document.getElementById('audioPlayer');
                if (audioPlayer) {
                    audioPlayer.addEventListener('play', () => {
                        this.trackPlayEvent();
                    });
                }
            }

            trackPlayEvent() {
                // Update AI learning based on user interactions
                this.updateUserPreferences();
            }

            loadUserPreferences() {
                return JSON.parse(localStorage.getItem('music_ai_preferences') || '{}');
            }

            updateUserPreferences() {
                // In a real implementation, this would update based on actual user behavior
                const preferences = this.loadUserPreferences();
                preferences.lastActivity = Date.now();
                localStorage.setItem('music_ai_preferences', JSON.stringify(preferences));
            }
        }

        // Global mood discovery functions
        window.discoverByMood = (mood) => {
            if (window.musicAIDashboard) {
                window.musicAIDashboard.discoverByMood(mood);
            }
        };

        window.askAI = () => {
            if (window.musicAIDashboard) {
                window.musicAIDashboard.askAI();
            }
        };

        window.applyAIPricing = () => {
            if (window.musicAIDashboard) {
                window.musicAIDashboard.applyAIPricing();
            }
        };

        // Timer-gated progression system removed - all tracks now stream freely

        // Initialize Music AI Dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add CSS animations for notifications
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Initialize only AI Dashboard (progression system removed)
            setTimeout(() => {
                window.musicAIDashboard = new MusicAIDashboard();
            }, 1000);
        });
    </script>

    <!-- Load AI Chat Interface and Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" async></script>
    <script src="/js/ai-chat-interface.js" async></script>
</body>
</html>